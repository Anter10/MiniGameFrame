{"version":3,"sources":["../../../../assets/WXFrame/assets/WXFrame/MNGConst.js"],"names":["MNGConst","restTime","crypto","require","WXSdk","appinfo","appid","wxAppId","gameid","loginUrl","admsgUrl","shareUrl","version","delItem","key","cc","sys","localStorage","removeItem","tywx","isInWXChat","wx","removeUserCloudStorage","keyList","success","msg","console","log","fail","saveItem","value","only_local","setItem","setUserCloudStorage","KVDataList","loadItem","default_value","v","getItem","share2GroupByTicket","tag","result","success_cb","fail_cb","shareTickets","call_succ","call_fail","ff","getShareInfo","shareTicket","res","iv","encryptedData","resultStr","decrypt","UserInfo","wxgame_session_key","resultObj","JSON","parse","id","openGId","t0","parseInt","tc","Date","getTime","e","getRandomShareConfigByShareTag","share_tag","config","tmp_arr","PropagateInterface","ShareConfig","hasOwnProperty","rand_idx","Math","random","length","crypted","decoded","Buffer","decipher","createDecipheriv","setAutoPadding","update","final","err","showWXToast","duration","showToast","title","icon","error","showWXModal","content","show_cancel","sure_cb","cancle_cb","showModal","showCancel","confirm","cancel","module","exports"],"mappings":"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","file":"MNGConst.js","sourceRoot":"../../../../assets/WXFrame","sourcesContent":["\nvar MNGConst = {};\n\nMNGConst.restTime = 2 * 60 * 60;\n\nvar crypto = require('crypto');\n\nWXSdk.MNGConst = MNGConst;\n \nMNGConst.appinfo = {\n    appid:\"wx1271gaycadc121\",\n    wxAppId: \"wx1271gaycadc121\",\n    gameid:\"100001\",\n    loginUrl:\"\",\n    admsgUrl:\"\",\n    shareUrl:\"\",\n    version:\"100\",\n    \n};\n\n\nMNGConst.delItem = function (key) {\n    cc.sys.localStorage.removeItem(key);\n    if (!tywx.isInWXChat)\n        return;\n    wx.removeUserCloudStorage({\n        keyList: [key],\n        success: (msg) => {\n            console.log('removeObjectCloud  ' + key + ' succeeds', msg);\n        },\n        fail: (msg) => {\n            console.log('removeObjectCloud  ' + key + ' fails', msg);\n        },\n    });\n};\n\n/**\n * * 保存数据到本地\n *\n * @static\n * @param {String} key 标识\n * @param {any} value\n * @param {boolean} only_local 是否只保存在本地,false的情况，上传到腾讯云\n * @returns\n */\nMNGConst.saveItem = function (key, value, only_local) {\n    value = value + '';\n    cc.sys.localStorage.setItem(key, value);\n    if (!tywx.isInWXChat)\n        return;\n    if (!only_local) {\n        //FIXED: 做版本检测，版本低的会有黑屏\n        if (wx.setUserCloudStorage) {\n            wx.setUserCloudStorage({\n                KVDataList: [{\n                    key: key,\n                    value: value\n                }],\n                success: (msg) => {\n                    console.log('saveObjectToCloud  ' + key + ' succeeds', msg);\n                },\n                fail: (msg) => {\n                    console.log('saveObjectToCloud  ' + key + ' fails', msg);\n                },\n            });\n        }\n    }\n};\n\n/**\n * * 加载保存在本地的数据\n *\n * @static\n * @param {String} key 标识\n * @param {any} default_value 默认值\n * @returns\n */\nMNGConst.loadItem = function (key, default_value) {\n    var v = cc.sys.localStorage.getItem(key);\n    // console.log(key, 'v'+v);\n    if (!v) {\n        cc.sys.localStorage.setItem(key, default_value);\n        return default_value;\n    }\n    return v;\n};\n/**\n * @description 分享到不同群限制\n * @author lu ning\n * @date 2018-08-22\n * @static\n * @param {String} tag 分享tag\n * @param {Object} result 分享返回值\n * @param {Function} success_cb 成功回调\n * @param {Function} fail_cb 失败回调\n * @returns\n */\nMNGConst.share2GroupByTicket = function (tag, result, success_cb, fail_cb) {\n    if (!result.shareTickets || !result.shareTickets[0]) return false;\n    let call_succ = () => {\n        if (success_cb) success_cb();\n    };\n    let call_fail = () => {\n        if (fail_cb) fail_cb();\n    };\n    let ff = MNGConst;\n\n    wx.getShareInfo({\n        shareTicket: result.shareTickets[0],\n        success: (res) => {\n            console.log('isCanShare2GroupByTicket==>', res);\n            try {\n                let iv = res.iv;\n                let encryptedData = res.encryptedData;\n                let resultStr = ff.decrypt(tywx.UserInfo.wxgame_session_key, iv, encryptedData);\n                console.log('resultStr==>', resultStr);\n                if (resultStr && resultStr !== 0) {\n                    let resultObj = JSON.parse(resultStr);\n                    let id = `${tag}_${resultObj.openGId}`;\n                    let t0 = parseInt(ff.loadItem(id, 0));\n                    let tc = new Date().getTime();\n                    console.log('isCanShare2GroupByTicket==>openGId', id, typeof id);\n                    if (tc - t0 >= 24 * 60 * 60 * 1000) {\n                        ff.saveItem(id, tc, true);\n                        call_succ();\n                    } else {\n                        call_fail();\n                    }\n                } else {\n                    call_fail();\n                }\n\n            } catch (e) {\n                console.log(\"share::\", e);\n                call_fail();\n            }\n        },\n        fail: () => {\n            call_fail();\n        }\n    });\n};\n\n/**\n * @description 获取随机分享数据\n * @author lu ning\n * @date 2018-08-23\n * @static\n * @param {String} share_tag\n */\nMNGConst.getRandomShareConfigByShareTag = function (share_tag) {\n    let config = null;\n    let tmp_arr = [];\n    if (tywx.PropagateInterface.ShareConfig.hasOwnProperty(share_tag)) {\n        tmp_arr = tywx.PropagateInterface.ShareConfig[share_tag];\n        let rand_idx = parseInt(Math.random() * tmp_arr.length);\n        config = tmp_arr[rand_idx];\n    }\n    return config;\n};\n\nMNGConst.decrypt = function (key, iv, crypted) {\n    var decoded = 0;\n    try {\n        crypted = new Buffer(crypted, 'base64');\n        iv = new Buffer(iv, 'base64');\n        key = new Buffer(key, 'base64');\n\n        var decipher = crypto.createDecipheriv('aes-128-cbc', key, iv);\n        decipher.setAutoPadding(true);\n\n        decoded = decipher.update(crypted, 'binary', 'utf8');\n        decoded += decipher.final('utf8');\n    } catch (err) {\n        console.log(\"decrypt\", \" catch error: \" + err);\n    }\n    return decoded;\n};\n\n/**\n * @description \n * @author lu ning\n * @date 2018-08-24\n * @static\n * @param {String} msg\n * @param {number} [duration=1000]\n */\nMNGConst.showWXToast = function (msg, duration = 1000) {\n    if (wx.showToast) {\n        wx.showToast({\n            title: msg,\n            icon: '',\n            duration: duration\n        });\n    } else {\n        cc.error('showWXToast error can not find function wx.showToast');\n    }\n};\n/**\n * @description 显示模态窗\n * @author lu ning\n * @date 2018-08-24\n * @static\n * @param {String} content 显示内容\n * @param {String} [title='提示'] title\n * @param {boolean} [show_cancle=false]  是否显示取消\n * @param {Function} [sure_cb=null] 确定按钮回调\n * @param {Function} [cancle_cb=null] 取消按钮回调\n */\nMNGConst.showWXModal = function (content, title = '提示', show_cancel = false, sure_cb = null, cancle_cb = null) {\n    wx.showModal({\n        title: title,\n        content: content,\n        showCancel: show_cancel,\n        success: function (res) {\n            if (res.confirm) {\n                console.log('用户点击确定');\n                sure_cb && sure_cb();\n            } else if (res.cancel) {\n                console.log('用户点击取消');\n                cancle_cb && cancle_cb();\n            }\n        }\n    });\n};\n\nmodule.exports = MNGConst;\n"]}